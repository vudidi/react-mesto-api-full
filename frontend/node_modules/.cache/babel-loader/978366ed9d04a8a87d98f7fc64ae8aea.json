{"ast":null,"code":"import _toConsumableArray from\"C:/Users/User/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/User/dev/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import{Route,Redirect,Switch,useHistory}from\"react-router-dom\";import ProtectedRoute from\"./ProtectedRoute\";import Header from\"./Header\";import Footer from\"./Footer\";import Main from\"./Main\";import PopupWithForm from\"./PopupWithForm\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import ImagePopup from\"./ImagePopup\";import InfoTooltip from\"./InfoTooltip\";import Login from\"./Login\";import Register from\"./Register\";import api from\"../utils/Api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import*as Auth from\"../utils/Auth\";import iconErrorPath from\"../styles/images/reg-icon-error.png\";import iconSuccessPath from\"../styles/images/reg-icon-success.png\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setOpenEditProfile=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setOpenAddPlace=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setOpenEditAvatar=_React$useState6[1];var _React$useState7=React.useState({}),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isImageOpen=_React$useState10[0],setImageOpen=_React$useState10[1];var _React$useState11=React.useState({}),_React$useState12=_slicedToArray(_React$useState11,2),currentUser=_React$useState12[0],setCurrentUser=_React$useState12[1];var _React$useState13=React.useState([]),_React$useState14=_slicedToArray(_React$useState13,2),cards=_React$useState14[0],setCards=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];var _React$useState17=React.useState(\"\"),_React$useState18=_slicedToArray(_React$useState17,2),userEmail=_React$useState18[0],setUserEmail=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),isBurgerMenuOpen=_React$useState20[0],setBurgerMenuOpen=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isInfoTooltipOpen=_React$useState22[0],setInfoTooltipOpen=_React$useState22[1];var _React$useState23=React.useState(null),_React$useState24=_slicedToArray(_React$useState23,2),isRegistrationSuccess=_React$useState24[0],setRegistrationSuccess=_React$useState24[1];var _React$useState25=React.useState(true),_React$useState26=_slicedToArray(_React$useState25,2),isLoginSuccess=_React$useState26[0],setLoginSuccess=_React$useState26[1];var history=useHistory();React.useEffect(function(){tokenCheck();},[]);React.useEffect(function(){if(loggedIn){history.push(\"/\");Promise.all([api.getCards(),api.getProfile()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),cardsData=_ref2[0],userData=_ref2[1];setCards(cardsData);setCurrentUser(userData);}).catch(function(err){console.log(err);});}},[loggedIn]);function handleAddPlaceSubmit(data){api.addCard(data.name,data.link).then(function(res){setCards([res].concat(_toConsumableArray(cards)));setOpenAddPlace(false);}).catch(function(err){console.log(err);});}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,isLiked).then(function(newCard){var newLike=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newLike);}).catch(function(err){console.log(err);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(cardItem){setCards(function(arr){return arr.filter(function(c){return c._id!==card._id&&cardItem;});});}).catch(function(err){console.log(err);});}function handleUpdateUser(data){api.editProfile(data.name,data.about).then(function(res){setCurrentUser(res);setOpenEditProfile(false);}).catch(function(err){console.log(err);});}function handleUpdateAvatar(data){api.updateAvatar(data.avatar).then(function(res){setCurrentUser(res);setOpenEditAvatar(false);}).catch(function(err){console.log(err);});}function handleCardClick(card){setSelectedCard(card);setImageOpen(true);}function handleEditAvatarClick(){setOpenEditAvatar(true);}function handleEditProfileClick(){setOpenEditProfile(true);}function handleAddPlaceClick(){setOpenAddPlace(true);}function closeAllPopups(){setOpenEditAvatar(false);setOpenEditProfile(false);setOpenAddPlace(false);setImageOpen(false);setInfoTooltipOpen(false);}function handleRegisterUser(data){Auth.register(data.email,data.password).then(function(){setRegistrationSuccess(true);setInfoTooltipOpen(true);setTimeout(function(){setInfoTooltipOpen(false);history.push(\"/sign-in\");},1500);}).catch(function(err){setRegistrationSuccess(false);setInfoTooltipOpen(true);console.log(err);});}function handleLoginUser(data){Auth.authorize(data.email,data.password).then(function(res){localStorage.setItem(\"token\",res.token);tokenCheck();setLoggedIn(true);history.push(\"/\");}).catch(function(err){setLoginSuccess(false);setInfoTooltipOpen(true);console.log(err);});}function tokenCheck(){if(localStorage.getItem(\"token\")){var token=localStorage.getItem(\"token\");Auth.getContent(token).then(function(res){if(res){setUserEmail(res.data.email);setLoggedIn(true);}}).catch(function(err){console.log(err);});}}function handleSignOut(){localStorage.removeItem(\"token\");history.push(\"/sign-in\");setLoggedIn(false);}function toggleBurgerMenu(){setBurgerMenuOpen(!isBurgerMenuOpen);}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,onSignOut:handleSignOut,email:userEmail,onOpenMenu:toggleBurgerMenu,isMenuOpen:isBurgerMenuOpen}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(ProtectedRoute,{loggedIn:loggedIn,exact:true,path:\"/\",children:[/*#__PURE__*/_jsx(Main,{onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"confirm\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",buttonText:\"\\u0414\\u0430\"}),/*#__PURE__*/_jsx(ImagePopup,{onClose:closeAllPopups,card:selectedCard,isOpen:isImageOpen})]}),/*#__PURE__*/_jsxs(Route,{path:\"/sign-in\",children:[/*#__PURE__*/_jsx(Login,{handleLogin:handleLoginUser}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,isSuccess:isLoginSuccess,infoIcon:isLoginSuccess?iconSuccessPath:iconErrorPath,infoMessage:isLoginSuccess?\"Вы успешно зарегистрировались!\":\"Что-то пошло не так! Попробуйте ещё раз.\"})]}),/*#__PURE__*/_jsxs(Route,{path:\"/sign-up\",children:[/*#__PURE__*/_jsx(Register,{handleRegister:handleRegisterUser}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,isSuccess:isRegistrationSuccess,infoIcon:isRegistrationSuccess?iconSuccessPath:iconErrorPath,infoMessage:isRegistrationSuccess?\"Вы успешно зарегистрировались!\":\"Что-то пошло не так! Попробуйте ещё раз.\"})]}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["C:/Users/User/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Route","Redirect","Switch","useHistory","ProtectedRoute","Header","Footer","Main","PopupWithForm","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ImagePopup","InfoTooltip","Login","Register","api","CurrentUserContext","Auth","iconErrorPath","iconSuccessPath","App","useState","isEditProfilePopupOpen","setOpenEditProfile","isAddPlacePopupOpen","setOpenAddPlace","isEditAvatarPopupOpen","setOpenEditAvatar","selectedCard","setSelectedCard","isImageOpen","setImageOpen","currentUser","setCurrentUser","cards","setCards","loggedIn","setLoggedIn","userEmail","setUserEmail","isBurgerMenuOpen","setBurgerMenuOpen","isInfoTooltipOpen","setInfoTooltipOpen","isRegistrationSuccess","setRegistrationSuccess","isLoginSuccess","setLoginSuccess","history","useEffect","tokenCheck","push","Promise","all","getCards","getProfile","then","cardsData","userData","catch","err","console","log","handleAddPlaceSubmit","data","addCard","name","link","res","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newLike","map","c","handleCardDelete","deleteCard","cardItem","arr","filter","handleUpdateUser","editProfile","about","handleUpdateAvatar","updateAvatar","avatar","handleCardClick","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","closeAllPopups","handleRegisterUser","register","email","password","setTimeout","handleLoginUser","authorize","localStorage","setItem","token","getItem","getContent","handleSignOut","removeItem","toggleBurgerMenu"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Route, Redirect, Switch, useHistory } from \"react-router-dom\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport Main from \"./Main\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport ImagePopup from \"./ImagePopup\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport api from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport * as Auth from \"../utils/Auth\";\nimport iconErrorPath from \"../styles/images/reg-icon-error.png\";\nimport iconSuccessPath from \"../styles/images/reg-icon-success.png\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setOpenEditProfile] = React.useState(false);\n  const [isAddPlacePopupOpen, setOpenAddPlace] = React.useState(false);\n  const [isEditAvatarPopupOpen, setOpenEditAvatar] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [isImageOpen, setImageOpen] = React.useState(false);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [userEmail, setUserEmail] = React.useState(\"\");\n  const [isBurgerMenuOpen, setBurgerMenuOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false);\n  const [isRegistrationSuccess, setRegistrationSuccess] = React.useState(null);\n  const [isLoginSuccess, setLoginSuccess] = React.useState(true);\n  const history = useHistory();\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  React.useEffect(() => {\n    if (loggedIn) {\n      history.push(\"/\");\n      Promise.all([api.getCards(), api.getProfile()])\n        .then(([cardsData, userData]) => {\n          setCards(cardsData);\n          setCurrentUser(userData);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }, [loggedIn]);\n\n  function handleAddPlaceSubmit(data) {\n    api\n      .addCard(data.name, data.link)\n      .then((res) => {\n        setCards([res, ...cards]);\n        setOpenAddPlace(false);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    api\n      .changeLikeCardStatus(card._id, isLiked)\n      .then((newCard) => {\n        const newLike = cards.map((c) => (c._id === card._id ? newCard : c));\n        setCards(newLike);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleCardDelete(card) {\n    api\n      .deleteCard(card._id)\n      .then((cardItem) => {\n        setCards((arr) => arr.filter((c) => c._id !== card._id && cardItem));\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleUpdateUser(data) {\n    api\n      .editProfile(data.name, data.about)\n      .then((res) => {\n        setCurrentUser(res);\n        setOpenEditProfile(false);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleUpdateAvatar(data) {\n    api\n      .updateAvatar(data.avatar)\n      .then((res) => {\n        setCurrentUser(res);\n        setOpenEditAvatar(false);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setImageOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setOpenEditAvatar(true);\n  }\n\n  function handleEditProfileClick() {\n    setOpenEditProfile(true);\n  }\n\n  function handleAddPlaceClick() {\n    setOpenAddPlace(true);\n  }\n\n  function closeAllPopups() {\n    setOpenEditAvatar(false);\n    setOpenEditProfile(false);\n    setOpenAddPlace(false);\n    setImageOpen(false);\n    setInfoTooltipOpen(false);\n  }\n\n  function handleRegisterUser(data) {\n    Auth.register(data.email, data.password)\n      .then(() => {\n        setRegistrationSuccess(true);\n        setInfoTooltipOpen(true);\n        setTimeout(() => {\n          setInfoTooltipOpen(false);\n          history.push(\"/sign-in\");\n        }, 1500);\n      })\n      .catch((err) => {\n        setRegistrationSuccess(false);\n        setInfoTooltipOpen(true);\n        console.log(err);\n      });\n  }\n\n  function handleLoginUser(data) {\n    Auth.authorize(data.email, data.password)\n      .then((res) => {\n        localStorage.setItem(\"token\", res.token);\n        tokenCheck();\n        setLoggedIn(true);\n        history.push(\"/\");\n      })\n      .catch((err) => {\n        setLoginSuccess(false);\n        setInfoTooltipOpen(true);\n        console.log(err);\n      });\n  }\n\n  function tokenCheck() {\n    if (localStorage.getItem(\"token\")) {\n      const token = localStorage.getItem(\"token\");\n      Auth.getContent(token)\n        .then((res) => {\n          if (res) {\n            setUserEmail(res.data.email);\n            setLoggedIn(true);\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }\n\n  function handleSignOut() {\n    localStorage.removeItem(\"token\");\n    history.push(\"/sign-in\");\n    setLoggedIn(false);\n  }\n\n  function toggleBurgerMenu() {\n    setBurgerMenuOpen(!isBurgerMenuOpen);\n  }\n\n  return (\n    <div className=\"App\">\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header\n          loggedIn={loggedIn}\n          onSignOut={handleSignOut}\n          email={userEmail}\n          onOpenMenu={toggleBurgerMenu}\n          isMenuOpen={isBurgerMenuOpen}\n        />\n        <Switch>\n          <ProtectedRoute loggedIn={loggedIn} exact path=\"/\">\n            <Main\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onCardClick={handleCardClick}\n              cards={cards}\n              onCardLike={handleCardLike}\n              onCardDelete={handleCardDelete}\n            />\n\n            <EditProfilePopup\n              isOpen={isEditProfilePopupOpen}\n              onClose={closeAllPopups}\n              onUpdateUser={handleUpdateUser}\n            />\n            <EditAvatarPopup\n              isOpen={isEditAvatarPopupOpen}\n              onClose={closeAllPopups}\n              onUpdateAvatar={handleUpdateAvatar}\n            />\n            <AddPlacePopup\n              isOpen={isAddPlacePopupOpen}\n              onClose={closeAllPopups}\n              onAddPlace={handleAddPlaceSubmit}\n            />\n\n            <PopupWithForm name=\"confirm\" title=\"Вы уверены?\" buttonText=\"Да\" />\n\n            <ImagePopup\n              onClose={closeAllPopups}\n              card={selectedCard}\n              isOpen={isImageOpen}\n            />\n          </ProtectedRoute>\n\n          <Route path=\"/sign-in\">\n            <Login handleLogin={handleLoginUser} />\n            <InfoTooltip\n              isOpen={isInfoTooltipOpen}\n              onClose={closeAllPopups}\n              isSuccess={isLoginSuccess}\n              infoIcon={isLoginSuccess ? iconSuccessPath : iconErrorPath}\n              infoMessage={\n                isLoginSuccess\n                  ? \"Вы успешно зарегистрировались!\"\n                  : \"Что-то пошло не так! Попробуйте ещё раз.\"\n              }\n            />\n          </Route>\n\n          <Route path=\"/sign-up\">\n            <Register handleRegister={handleRegisterUser} />\n            <InfoTooltip\n              isOpen={isInfoTooltipOpen}\n              onClose={closeAllPopups}\n              isSuccess={isRegistrationSuccess}\n              infoIcon={isRegistrationSuccess ? iconSuccessPath : iconErrorPath}\n              infoMessage={\n                isRegistrationSuccess\n                  ? \"Вы успешно зарегистрировались!\"\n                  : \"Что-то пошло не так! Попробуйте ещё раз.\"\n              }\n            />\n          </Route>\n\n          <Route>\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\n          </Route>\n        </Switch>\n        <Footer />\n      </CurrentUserContext.Provider>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}